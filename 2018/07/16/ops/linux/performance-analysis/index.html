<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="performance,ops,linux," />










<meta name="description" content="Linux 下的性能分析uptimeuptime - Tell how long the system has been running.  DESCRIPTION   uptime gives a one line display of the following information.  The cur‐    rent time, how long the system has been">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux下性能分析工具">
<meta property="og:url" content="https://sanbornzhang.github.io/2018/07/16/ops/linux/performance-analysis/index.html">
<meta property="og:site_name" content="Sanborn">
<meta property="og:description" content="Linux 下的性能分析uptimeuptime - Tell how long the system has been running.  DESCRIPTION   uptime gives a one line display of the following information.  The cur‐    rent time, how long the system has been">
<meta property="og:locale">
<meta property="article:published_time" content="2018-07-15T16:00:00.000Z">
<meta property="article:modified_time" content="2021-06-05T08:06:12.024Z">
<meta property="article:author" content="Sanborn">
<meta property="article:tag" content="performance">
<meta property="article:tag" content="ops">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://Sanbornzhang.github.io/2018/07/16/ops/linux/performance-analysis/"/>





  <title>Linux下性能分析工具 | Sanborn</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sanborn</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">爱吃酸菜的鱼</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://Sanbornzhang.github.io/2018/07/16/ops/linux/performance-analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sanborn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://lh3.googleusercontent.com/-po30YqlBIEM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDu1zlBJlhwEJGqQ_2X6Otn9K16w/s64-c-mo/photo.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sanborn">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Linux下性能分析工具</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-16T00:00:00+08:00">
                2018-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/ops/" itemprop="url" rel="index">
                    <span itemprop="name">ops</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/ops/performance/" itemprop="url" rel="index">
                    <span itemprop="name">performance</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Linux-下的性能分析"><a href="#Linux-下的性能分析" class="headerlink" title="Linux 下的性能分析"></a><code>Linux</code> 下的性能分析</h1><h2 id="uptime"><a href="#uptime" class="headerlink" title="uptime"></a>uptime</h2><pre><code>uptime - Tell how long the system has been running.
</code></pre>
<h3 id="DESCRIPTION"><a href="#DESCRIPTION" class="headerlink" title="DESCRIPTION"></a>DESCRIPTION</h3><pre><code>   uptime gives a one line display of the following information.  The cur‐
   rent time, how long the system has been running,  how  many  users  are
   currently  logged  on,  and the system load averages for the past 1, 5,
   and 15 minutes.

   This is the same information contained in the header line displayed  by
   w(1).

   System load averages is the average number of processes that are either
   in a runnable or uninterruptable state.  A process in a runnable  state
   is  either using the CPU or waiting to use the CPU.  A process in unin‐
   terruptable state is waiting for some I/O access, eg waiting for  disk.
   The  averages  are  taken over the three time intervals.  Load averages
   are not normalized for the number of CPUs in a system, so a load  aver‐
   age  of 1 means a single CPU system is loaded all the time while on a 4
   CPU system it means it was idle 75% of the time.
</code></pre>
<p>我们可以看出： 系统平均负载是过去1、5、15分钟值, 在之下又有解释说明 1 在 4C的机器中说明它**75%**都是处于空闲状态，那么也就是说 1C 的平均为1最佳[实际上80%就可以了]</p>
<span id="more"></span>
<ul>
<li><p>一台线上的实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep &#x27;CPU&#x27; /proc/cpuinfo |wc -l</span><br><span class="line">2</span><br><span class="line"></span><br><span class="line">uptime </span><br><span class="line">    09:38:06 up 153 days, 21:38,  2 users,  load average: 0.71, 1.00, 0.85</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这是一台2C的机器，我们看出这台机器基本上使用了1C的cpu 负载在50%左右</p>
</blockquote>
</li>
</ul>
<h2 id="sysstat"><a href="#sysstat" class="headerlink" title="sysstat"></a>sysstat</h2><ul>
<li><p><code>mpstat -P ALL 5   </code><br>监控所有的CPU 每隔<em>5S</em> 输出到屏幕</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Linux 4.4.0-117-generic (k8s-master)    05/31/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">09:57:38 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle</span><br><span class="line">09:57:43 AM  all    5.16    0.00    3.44    0.40    0.00    0.10    0.00    0.00    0.00   90.90</span><br><span class="line">09:57:43 AM    0    5.67    0.00    3.44    0.20    0.00    0.20    0.00    0.00    0.00   90.49</span><br><span class="line">09:57:43 AM    1    4.66    0.00    3.44    0.40    0.00    0.00    0.00    0.00    0.00   91.50</span><br><span class="line"></span><br><span class="line">09:57:43 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle</span><br><span class="line">09:57:48 AM  all    4.78    0.00    3.39    0.40    0.00    0.20    0.00    0.00    0.00   91.24</span><br><span class="line">09:57:48 AM    0    5.20    0.00    3.00    0.40    0.00    0.00    0.00    0.00    0.00   91.40</span><br><span class="line">09:57:48 AM    1    4.18    0.00    3.78    0.60    0.00    0.20    0.00    0.00    0.00   91.24</span><br><span class="line"></span><br><span class="line">09:57:48 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle</span><br><span class="line">09:57:53 AM  all    5.32    0.00    2.81    0.60    0.00    0.10    0.00    0.00    0.00   91.16</span><br><span class="line">09:57:53 AM    0    5.21    0.00    3.61    0.60    0.00    0.20    0.00    0.00    0.00   90.38</span><br><span class="line">09:57:53 AM    1    5.61    0.00    2.00    0.60    0.00    0.20    0.00    0.00    0.00   91.58</span><br><span class="line"></span><br><span class="line">09:57:53 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle</span><br><span class="line">09:57:58 AM  all    6.07    0.00    3.38    0.50    0.00    0.20    0.00    0.00    0.00   89.85</span><br></pre></td></tr></table></figure></li>
<li><p><code>pidstat -u 5 1 </code>: 间隔<code>5S</code>后输出1组数据[CPU使用指标]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Linux 4.4.0-117-generic (k8s-master)    05/31/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">10:00:16 AM   UID       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">10:00:21 AM     0        13    0.00    0.20    0.00    0.20     1  ksoftirqd/1</span><br><span class="line">10:00:21 AM   999      2750   17.96    0.20    0.00   18.16     0  mysqld</span><br><span class="line">10:00:21 AM     0      4928    2.20    0.80    0.00    2.99     1  kubelet</span><br><span class="line">10:00:21 AM     0      9244    1.00    0.00    0.00    1.00     0  dockerd</span><br><span class="line">10:00:21 AM   999      9513    0.00    0.20    0.00    0.20     1  redis-server</span><br><span class="line">10:00:21 AM     0     10026    0.40    0.00    0.00    0.40     1  containerd-shim</span><br><span class="line">10:00:21 AM     0     10034    0.40    0.20    0.00    0.60     1  kube-scheduler</span><br><span class="line">10:00:21 AM     0     10066    1.80    1.00    0.00    2.79     1  kube-apiserver</span><br><span class="line">10:00:21 AM     0     10148    1.20    0.60    0.00    1.80     1  etcd</span><br><span class="line">10:00:21 AM     0     10580    0.00    0.20    0.00    0.20     1  kube-proxy</span><br><span class="line">10:00:21 AM     0     10944    0.00    0.20    0.00    0.20     1  coredns</span><br><span class="line">10:00:21 AM     0     11195    0.00    0.20    0.00    0.20     1  coredns</span><br><span class="line">10:00:21 AM     0     11248    0.20    0.60    0.00    0.80     1  calico-node</span><br><span class="line">10:00:21 AM     0     11419    0.80    1.00    0.00    1.80     1  kube-controller</span><br><span class="line">10:00:21 AM     0     20587    0.20    0.20    0.00    0.40     1  containerd</span><br><span class="line">10:00:21 AM   999     24608    0.20    0.00    0.00    0.20     1  redis-server</span><br><span class="line">10:00:21 AM     0     27397    0.40    0.00    0.00    0.40     1  AliYunDun</span><br><span class="line"></span><br><span class="line">Average:      UID       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">Average:        0        13    0.00    0.20    0.00    0.20     -  ksoftirqd/1</span><br><span class="line">Average:      999      2750   17.96    0.20    0.00   18.16     -  mysqld</span><br><span class="line">Average:        0      4928    2.20    0.80    0.00    2.99     -  kubelet</span><br><span class="line">Average:        0      9244    1.00    0.00    0.00    1.00     -  dockerd</span><br><span class="line">Average:      999      9513    0.00    0.20    0.00    0.20     -  redis-server</span><br><span class="line">Average:        0     10026    0.40    0.00    0.00    0.40     -  containerd-shim</span><br><span class="line">Average:        0     10034    0.40    0.20    0.00    0.60     -  kube-scheduler</span><br><span class="line">Average:        0     10066    1.80    1.00    0.00    2.79     -  kube-apiserver</span><br><span class="line">Average:        0     10148    1.20    0.60    0.00    1.80     -  etcd</span><br><span class="line">Average:        0     10580    0.00    0.20    0.00    0.20     -  kube-proxy</span><br><span class="line">Average:        0     10944    0.00    0.20    0.00    0.20     -  coredns</span><br><span class="line">Average:        0     11195    0.00    0.20    0.00    0.20     -  coredns</span><br><span class="line">Average:        0     11248    0.20    0.60    0.00    0.80     -  calico-node</span><br><span class="line">Average:        0     11419    0.80    1.00    0.00    1.80     -  kube-controller</span><br><span class="line">Average:        0     20587    0.20    0.20    0.00    0.40     -  containerd</span><br><span class="line">Average:      999     24608    0.20    0.00    0.00    0.20     -  redis-server</span><br><span class="line">Average:        0     27397    0.40    0.00    0.00    0.40     -  AliYunDun</span><br></pre></td></tr></table></figure></li>
<li><p>pidstat -w -u 5              cswch/s 自愿切换上下文   nvcswch 非自愿切换上下文                                        </p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Linux 4.4.0-117-generic (k8s-master)    05/31/2019      _x86_64_        (2 CPU)</span><br><span class="line"></span><br><span class="line">11:42:29 AM   UID       PID    %usr %system  %guest    %CPU   CPU  Command</span><br><span class="line">11:42:34 AM   999      2750   15.80    0.20    0.00   16.00     0  mysqld</span><br><span class="line">11:42:34 AM  1001      4329    0.40    0.00    0.00    0.40     0  prometheus</span><br><span class="line">11:42:34 AM   112      4563    0.20    0.00    0.00    0.20     1  grafana-server</span><br><span class="line">11:42:34 AM     0      4928    1.80    0.60    0.00    2.40     1  kubelet</span><br><span class="line">11:42:34 AM     0      9244    1.20    0.20    0.00    1.40     0  dockerd</span><br><span class="line">11:42:34 AM   999      9513    0.20    0.60    0.00    0.80     0  redis-server</span><br><span class="line">11:42:34 AM     0     10026    0.40    0.00    0.00    0.40     0  containerd-shim</span><br><span class="line">11:42:34 AM     0     10034    0.20    0.40    0.00    0.60     0  kube-scheduler</span><br><span class="line">11:42:34 AM     0     10066    1.00    0.80    0.00    1.80     1  kube-apiserver</span><br><span class="line">11:42:34 AM     0     10148    0.40    0.40    0.00    0.80     1  etcd</span><br><span class="line">11:42:34 AM     0     10944    0.00    0.20    0.00    0.20     1  coredns</span><br><span class="line">11:42:34 AM     0     11195    0.00    0.20    0.00    0.20     1  coredns</span><br><span class="line">11:42:34 AM     0     11248    0.40    0.20    0.00    0.60     0  calico-node</span><br><span class="line">11:42:34 AM     0     11254    0.00    0.20    0.00    0.20     0  calico-node</span><br><span class="line">11:42:34 AM     0     11419    1.00    0.80    0.00    1.80     0  kube-controller</span><br><span class="line">11:42:34 AM     0     17373    0.00    0.20    0.00    0.20     1  pidstat</span><br><span class="line">11:42:34 AM     0     20587    0.00    0.20    0.00    0.20     1  containerd</span><br><span class="line">11:42:34 AM     0     27397    0.20    0.20    0.00    0.40     0  AliYunDun</span><br><span class="line"></span><br><span class="line">11:42:29 AM   UID       PID   cswch/s nvcswch/s  Command</span><br><span class="line">11:42:34 AM     0         1      0.20      0.00  systemd</span><br><span class="line">11:42:34 AM     0         3      6.80      0.00  ksoftirqd/0</span><br><span class="line">11:42:34 AM     0         7    106.20      0.00  rcu_sched</span><br><span class="line">11:42:34 AM     0         9      2.20      0.00  migration/0</span><br><span class="line">11:42:34 AM     0        10      0.40      0.00  watchdog/0</span><br><span class="line">11:42:34 AM     0        11      0.40      0.00  watchdog/1</span><br><span class="line">11:42:34 AM     0        12      2.00      0.00  migration/1</span><br><span class="line">11:42:34 AM     0        13     25.20      0.00  ksoftirqd/1</span><br><span class="line">11:42:34 AM     0       155      4.20      0.00  kworker/0:1H</span><br><span class="line">11:42:34 AM     0       161     15.80      0.00  kworker/1:1H</span><br><span class="line">11:42:34 AM     0       163     15.00      3.60  jbd2/vda1-8</span><br><span class="line">11:42:34 AM     0       242      0.20      0.00  systemd-udevd</span><br><span class="line">11:42:34 AM   108       749      1.00      0.00  ntpd</span><br><span class="line">11:42:34 AM  1001      4329      0.60      0.40  prometheus</span><br><span class="line">11:42:34 AM     0      8802      0.20      0.00  rpcbind</span><br><span class="line">11:42:34 AM   999      9513    257.20      0.40  redis-server</span><br><span class="line">11:42:34 AM     0     10026      0.20      0.00  containerd-shim</span><br><span class="line">11:42:34 AM     0     10034     71.00     31.40  kube-scheduler</span><br><span class="line">11:42:34 AM     0     10110      0.20      0.00  runsvdir</span><br><span class="line">11:42:34 AM     0     11248      9.80      0.60  calico-node</span><br></pre></td></tr></table></figure></li>
<li><p>vmstat</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</span><br><span class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</span><br><span class="line"> 0  0      0 135488 167788 1630900    0    0     4   119    1    1  6  3 90  1  0</span><br><span class="line"> 0  0      0 134924 167796 1630916    0    0     0   442 5056 11673 14  4 82  1  0</span><br><span class="line"> 0  0      0 135068 167804 1630940    0    0     0   218 4560 11000  5  3 91  0  0</span><br><span class="line"> 1  0      0 136240 167812 1630960    0    0     0   203 4394 10925  6  3 91  0  0</span><br><span class="line"> 0  0      0 134628 167816 1630984    0    0     0    85 4320 10626  8  3 89  0  0</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>查看系统软切换信息 <code>cat /proc/softirqs</code> </p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">                    CPU0       CPU1</span><br><span class="line">          HI:          0          0</span><br><span class="line">       TIMER: 1436812899 1411920240</span><br><span class="line">      NET_TX:        448        528</span><br><span class="line">      NET_RX: 1343882698 1964105257</span><br><span class="line">       BLOCK:          0          0</span><br><span class="line">BLOCK_IOPOLL:          0          0</span><br><span class="line">     TASKLET:       2319       2601</span><br><span class="line">       SCHED: 1315915373 1298055124</span><br><span class="line">     HRTIMER:          0          0</span><br><span class="line">         RCU: 1522799034 1508787415</span><br></pre></td></tr></table></figure>
<p> NET_TX: 网络接收中断<br> NET_RX: 网络发送中断</p>
</li>
<li><p>查看系统中断信息  <code>cat /proc/interrupts  </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">           CPU0       CPU1</span><br><span class="line">  0:         19          0   IO-APIC   2-edge      timer</span><br><span class="line">  1:         11        191   IO-APIC   1-edge      i8042</span><br><span class="line">  4:       1009          0   IO-APIC   4-edge      serial</span><br><span class="line">  6:          3          0   IO-APIC   6-edge      floppy</span><br><span class="line">  8:          0          0   IO-APIC   8-edge      rtc0</span><br><span class="line">  9:          0          0   IO-APIC   9-fasteoi   acpi</span><br><span class="line"> 11:         35          0   IO-APIC  11-fasteoi   virtio3, uhci_hcd:usb1</span><br><span class="line"> 12:         16        404   IO-APIC  12-edge      i8042</span><br><span class="line"> 14:          0          0   IO-APIC  14-edge      ata_piix</span><br><span class="line"> 15:          0          0   IO-APIC  15-edge      ata_piix</span><br><span class="line"> 24:          0          0   PCI-MSI 65536-edge      virtio1-config</span><br><span class="line"> 25:         32         18   PCI-MSI 65537-edge      virtio1-virtqueues</span><br><span class="line"> 26:          0          0   PCI-MSI 81920-edge      virtio2-config</span><br><span class="line"> 27:       4834  262320824   PCI-MSI 81921-edge      virtio2-req.0</span><br><span class="line"> 28:          1         22   PCI-MSI 49152-edge      virtio0-config</span><br><span class="line"> 29:        160  237500253   PCI-MSI 49153-edge      virtio0-input.0</span><br><span class="line"> 30:        164  201980849   PCI-MSI 49154-edge      virtio0-output.0</span><br><span class="line"> 31:          1  191833242   PCI-MSI 49155-edge      virtio0-input.1</span><br><span class="line"> 32:          1  202416880   PCI-MSI 49156-edge      virtio0-output.1</span><br><span class="line">NMI:          0          0   Non-maskable interrupts</span><br><span class="line">LOC: 1853064730 1867757275   Local timer interrupts</span><br><span class="line">SPU:          0          0   Spurious interrupts</span><br><span class="line">PMI:          0          0   Performance monitoring interrupts</span><br><span class="line">IWI:    4923006    4921126   IRQ work interrupts</span><br><span class="line">RTR:          0          0   APIC ICR read retries</span><br><span class="line">RES: 1704347415 1653338725   Rescheduling interrupts</span><br><span class="line">CAL:  468302632  252609617   Function call interrupts</span><br><span class="line">TLB:  252283278  251329281   TLB shootdowns</span><br></pre></td></tr></table></figure></li>
<li><p><code>cat /proc/stat</code> 中的 <code>intr</code> 也包含系统中断的信息</p>
</li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul>
<li>自愿上下文切换变多了，说明进程都在等待资源，有可能发生了 I/O问题</li>
<li>非自愿上下文切换变多了，说明进程都在被强制调度，也就是都在争抢 CPU，说明 CPU 的确成了瓶颈；</li>
<li>中断次数变多了，说明 CPU 被中断处理程序占用，</li>
</ul>
<h2 id="CPU-优化"><a href="#CPU-优化" class="headerlink" title="CPU 优化"></a>CPU 优化</h2><h3 id="应用程序优化"><a href="#应用程序优化" class="headerlink" title="应用程序优化"></a>应用程序优化</h3><ol>
<li>编译器优化</li>
<li>算法优化</li>
<li>异步处理 [Node.js call back]</li>
<li>多线程替代多进程[进程上下文切换，线程上下文切换(不涉及进程地址空间)]</li>
<li>善用缓存</li>
</ol>
<h3 id="系统优化"><a href="#系统优化" class="headerlink" title="系统优化"></a>系统优化</h3><ol>
<li>CPU绑定: 将进程绑定到一个或者多个CPU上，提高CPU缓存命中率。减少跨CPU调度带来的上下文切换问题。[taskset,sched_setaffinity]</li>
<li>CPU独占</li>
<li>优先级调整[PRI: 优先级(越小越先), NI: nice值(为负值优先级 <strong>值</strong> 变小), nice指定]</li>
<li>对进程设置资源限制</li>
<li>NUMA优化，让CPU尽可能之访问本地内存</li>
<li>中断负载均衡<h2 id="REF"><a href="#REF" class="headerlink" title="REF"></a>REF</h2><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-cn-linuxkernelint/index.html">Linux 内核中断内幕</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/rainharder/article/details/73198010">Nginx服务器上软中断过高问题如何解决？</a></li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/performance/" rel="tag"># performance</a>
          
            <a href="/tags/ops/" rel="tag"># ops</a>
          
            <a href="/tags/linux/" rel="tag"># linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/16/ops/linux/ulimit/" rel="next" title="linux ulimit 调参与优化">
                <i class="fa fa-chevron-left"></i> linux ulimit 调参与优化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/16/ops/docker/trouble-shooting/" rel="prev" title="Docker Trouble Shooting">
                Docker Trouble Shooting <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://lh3.googleusercontent.com/-po30YqlBIEM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDu1zlBJlhwEJGqQ_2X6Otn9K16w/s64-c-mo/photo.jpg"
                alt="Sanborn" />
            
              <p class="site-author-name" itemprop="name">Sanborn</p>
              <p class="site-description motion-element" itemprop="description">恍惚而过，不落昏沉</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">76</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">79</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">79</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Sanbornzhang" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux-%E4%B8%8B%E7%9A%84%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">1.</span> <span class="nav-text">Linux 下的性能分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#uptime"><span class="nav-number">1.1.</span> <span class="nav-text">uptime</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DESCRIPTION"><span class="nav-number">1.1.1.</span> <span class="nav-text">DESCRIPTION</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sysstat"><span class="nav-number">1.2.</span> <span class="nav-text">sysstat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">1.3.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CPU-%E4%BC%98%E5%8C%96"><span class="nav-number">1.4.</span> <span class="nav-text">CPU 优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%BC%98%E5%8C%96"><span class="nav-number">1.4.1.</span> <span class="nav-text">应用程序优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96"><span class="nav-number">1.4.2.</span> <span class="nav-text">系统优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REF"><span class="nav-number">1.5.</span> <span class="nav-text">REF</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sanborn</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
